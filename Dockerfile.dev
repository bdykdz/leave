# Development Dockerfile with cron support
FROM node:20-alpine

# Install cron and bash
RUN apk add --no-cache dcron bash curl

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install --legacy-peer-deps

# Copy application files
COPY . .

# Make scripts executable
RUN chmod +x /app/*.sh

# Create log directory
RUN mkdir -p /var/log && touch /var/log/cron.log

# Setup cron
RUN crontab /app/config/crontab

# Copy startup script for development
COPY start-dev.sh /app/start-dev.sh
RUN chmod +x /app/start-dev.sh

# Expose port
EXPOSE 3000

# Start both cron and the development server
CMD ["/bin/bash", "/app/start-dev.sh"]