services:
  leave-app-testing:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: leave-management-app-testing
    ports:
      - "3001:3000"
    environment:
      # Application
      - APP_ENV=production
      - APP_NAME=Leave Management Testing
      - NODE_ENV=production
      
      # Database
      - DATABASE_URL=postgresql://postgres:password@leave-db-testing:5432/leave_testing
      
      # Authentication
      - NEXTAUTH_URL=http://your-server-ip:3001
      - NEXTAUTH_SECRET=testing-secret-change-me-generate-with-openssl-rand-base64-32
      
      # Azure AD Configuration
      - AZURE_AD_CLIENT_ID=your-testing-client-id
      - AZURE_AD_CLIENT_SECRET=your-testing-client-secret
      - AZURE_AD_TENANT_ID=your-tenant-id
      
      # Security
      - SETUP_PASSWORD=testing-admin-password
      - CRON_SECRET=testing-cron-secret-generate-with-openssl-rand-base64-32
      
      # Email Configuration (Resend)
      - RESEND_API_KEY=re_123456789_your_testing_resend_api_key
      - RESEND_FROM_EMAIL=noreply@yourdomain.com
      - COMPANY_NAME=Your Company Name - Testing
      
      # Optional: Redis (for session storage)
      - REDIS_URL=redis://leave-redis-testing:6379
      
      # Optional: MinIO/S3 (for file storage)
      - MINIO_ENDPOINT=leave-minio-testing:9000
      - MINIO_ACCESS_KEY=testing-minio-access-key
      - MINIO_SECRET_KEY=testing-minio-secret-key
      - MINIO_BUCKET=leave-management-testing
    depends_on:
      - leave-db-testing
      - leave-redis-testing
      - leave-minio-testing
    restart: unless-stopped
    networks:
      - leave-testing-network

  leave-db-testing:
    image: postgres:15-alpine
    container_name: leave-management-db-testing
    ports:
      - "5433:5432"
    environment:
      - POSTGRES_DB=leave_testing
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - leave_testing_postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    networks:
      - leave-testing-network

  leave-redis-testing:
    image: redis:7-alpine
    container_name: leave-management-redis-testing
    ports:
      - "6380:6379"
    restart: unless-stopped
    networks:
      - leave-testing-network

  leave-minio-testing:
    image: minio/minio
    container_name: leave-management-minio-testing
    ports:
      - "9001:9000"
      - "9091:9090"
    environment:
      - MINIO_ROOT_USER=testing-minio-access-key
      - MINIO_ROOT_PASSWORD=testing-minio-secret-key
    command: server /data --console-address ":9090"
    volumes:
      - leave_testing_minio_data:/data
    restart: unless-stopped
    networks:
      - leave-testing-network

  leave-adminer-testing:
    image: adminer
    container_name: leave-management-adminer-testing
    ports:
      - "8081:8080"
    environment:
      - ADMINER_DEFAULT_SERVER=leave-db-testing
    restart: unless-stopped
    networks:
      - leave-testing-network

networks:
  leave-testing-network:
    name: leave-management-testing-network

volumes:
  leave_testing_postgres_data:
    name: leave-management-testing-data
  leave_testing_minio_data:
    name: leave-management-testing-minio-data